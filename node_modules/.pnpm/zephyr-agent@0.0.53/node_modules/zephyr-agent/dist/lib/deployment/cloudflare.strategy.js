"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.cloudflareStrategy = cloudflareStrategy;
const edge_actions_1 = require("../edge-actions");
const upload_assets_1 = require("./upload-base/upload-assets");
const upload_build_stats_and_enable_envs_1 = require("./upload-base/upload-build-stats-and-enable-envs");
async function cloudflareStrategy(zephyr_engine, { snapshot, getDashData, assets: { assetsMap, missingAssets } }) {
    const [versionUrl] = await Promise.all([
        (0, edge_actions_1.zeUploadSnapshot)(zephyr_engine, { snapshot }),
        (0, upload_assets_1.uploadAssets)(zephyr_engine, { assetsMap, missingAssets }),
    ]);
    // Waits for the reply to check upload problems, but the reply is a simply
    // 200 OK sent before any processing
    await (0, upload_build_stats_and_enable_envs_1.uploadBuildStatsAndEnableEnvs)(zephyr_engine, { getDashData, versionUrl });
    return versionUrl;
}
//# sourceMappingURL=cloudflare.strategy.js.map